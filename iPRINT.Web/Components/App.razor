<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/" />
    <ResourcePreloader />
    <link rel="stylesheet" href="@Assets["lib/bootstrap/dist/css/bootstrap.min.css"]" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="@Assets["app.css"]" />
    <link rel="stylesheet" href="@Assets["iPRINT.Web.styles.css"]" />
    <ImportMap />
    <link rel="icon" type="image/png" href="favicon.png" />
    <HeadOutlet />
</head>
<body>
    <Routes />
    <ReconnectModal />
    <script src="@Assets["_framework/blazor.web.js"]"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>

    <script>
        window.initNetworkGraph = (elements, species) => {
            const container = document.getElementById('cy');
            if (!container) return;

            if (!elements || elements.length === 0) {
                cytoscape({ container: container, elements: [] });
                return;
            }

            var cy = cytoscape({
                container: container,
                elements: elements,
                style: [
                    {
                        selector: 'node',
                        style: {
                            'label': 'data(id)',
                            'background-color': (ele) => ele.data('isQuery') ? '#CE0000' : '#D8BFD8',
                            'color': '#333',
                            'font-size': '10px',
                            'text-valign': 'center',
                            'width': (ele) => ele.data('isQuery') ? 38 : 24,
                            'height': (ele) => ele.data('isQuery') ? 38 : 24,
                            'border-width': 1,
                            'border-color': '#666'
                        }
                    },
                    {
                        selector: 'edge',
                        style: {
                            'width': 2,
                            'curve-style': 'bezier',
                            'target-arrow-shape': 'none', // no point
                            'line-color': (ele) => {
                                if (species === 'human') return '#cccccc'; // human：gray
                                
                                const label = ele.data('label');
                                if (label === 'Shared') return '#28a745';      // green
                                if (label === 'AD_specific') return '#dc3545'; // red
                                if (label === 'WT_specific') return '#007bff'; // blue
                                return '#adb5bd';
                            },
                            'opacity': 0.8
                        }
                    }
                ],
                layout: { 
                    name: 'cose', 
                    animate: true, 
                    padding: 30,
                    nodeRepulsion: 4500 
                }
            });
        };

        window.downloadFile = (fileName, content) => {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', fileName);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        };
    </script>
</body>
</html>